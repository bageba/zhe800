(function(f){f.Buffers=function(){this._s=new Array;this.type=false;if(arguments[0]=="queue"){this.type=true}};f.Buffers.prototype={push:function(j){if(arguments.length==0){return false}for(var h=0;h<arguments.length;h++){this._s.push(arguments[h])}return this._s.length},append:function(h){this.push(h)},pop:function(){if(this._s.length==0){return null}else{if(this.type){return this._s.pop()}else{return this._s.shift()}}},getTop:function(){if(this._s.length==0){return null}else{if(this.type){return this._s[this._s.length-1]}else{return this._s[0]}}},getLast:function(){if(this._s.length==0){return null}else{if(this.type){return this._s[0]}else{return this._s[this._s.length-1]}}},size:function(){return this._s.length},empty:function(){this._s.length=0},isEmpty:function(){if(this._s.length==0){return true}else{return false}},toString:function(){var h=this._s.join("");this._s.length=0;return h},toArray:function(){return this._s}};f.browser.name=(navigator.userAgent.toLowerCase().match(/\b(chrome|opera|safari|msie|firefox)\b/)||["","mozilla"])[1];f.browser.core=(navigator.userAgent.toLowerCase().match(/msie|webkit|gecko|opera|khtml/)||"msie");f.browser.ver=f.browser.version;if(window.Base64){return}else{function e(l){var j,k,h,m;j="";h=l.length;for(k=0;k<h;k++){m=l.charCodeAt(k);if((m>=1)&&(m<=127)){j+=l.charAt(k)}else{if(m>2047){j+=String.fromCharCode(224|((m>>12)&15));j+=String.fromCharCode(128|((m>>6)&63));j+=String.fromCharCode(128|((m>>0)&63))}else{j+=String.fromCharCode(192|((m>>6)&31));j+=String.fromCharCode(128|((m>>0)&63))}}}return j}function b(n){var j,l,h,o;var m,k;j="";h=n.length;l=0;while(l<h){o=n.charCodeAt(l++);switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:j+=n.charAt(l-1);break;case 12:case 13:m=n.charCodeAt(l++);j+=String.fromCharCode(((o&31)<<6)|(m&63));break;case 14:m=n.charCodeAt(l++);k=n.charCodeAt(l++);j+=String.fromCharCode(((o&15)<<12)|((m&63)<<6)|((k&63)<<0));break}}return j}var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var g=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);function c(o){var k,m,h;var n,l,j;h=o.length;m=0;k="";while(m<h){n=o.charCodeAt(m++)&255;if(m==h){k+=a.charAt(n>>2);k+=a.charAt((n&3)<<4);k+="==";break}l=o.charCodeAt(m++);if(m==h){k+=a.charAt(n>>2);k+=a.charAt(((n&3)<<4)|((l&240)>>4));k+=a.charAt((l&15)<<2);k+="=";break}j=o.charCodeAt(m++);k+=a.charAt(n>>2);k+=a.charAt(((n&3)<<4)|((l&240)>>4));k+=a.charAt(((l&15)<<2)|((j&192)>>6));k+=a.charAt(j&63)}return k}function d(p){var o,n,l,j;var m,h,k;h=p.length;m=0;k="";while(m<h){do{o=g[p.charCodeAt(m++)&255]}while(m<h&&o==-1);if(o==-1){break}do{n=g[p.charCodeAt(m++)&255]}while(m<h&&n==-1);if(n==-1){break}k+=String.fromCharCode((o<<2)|((n&48)>>4));do{l=p.charCodeAt(m++)&255;if(l==61){return k}l=g[l]}while(m<h&&l==-1);if(l==-1){break}k+=String.fromCharCode(((n&15)<<4)|((l&60)>>2));do{j=p.charCodeAt(m++)&255;if(j==61){return k}j=g[j]}while(m<h&&j==-1);if(j==-1){break}k+=String.fromCharCode(((l&3)<<6)|j)}return k}window.Base64={encode:function(h){return c(e(h))},decode:function(h){return b(d(h))}}}f.extend({getScript:function(k,j){var h=true,n=[],l=true,m=new Function;if(arguments.length>1){switch(f.type(j)){case"boolean":h=j;break;case"function":m=j;break;case"object":h=f.type(j.cache)=="boolean"?j.cache:h;l=f.type(j.crossDomain)=="boolean"?j.crossDomain:l;m=f.type(j.callback)=="function"?j.callback:m;n=f.type(j.parameter)=="array"?j.parameter:n;break}}f.ajax({type:"GET",url:k,crossDomain:l,success:function(p,o,r){try{m.apply(this,(n))}catch(q){if(window.console){console.log(q)}}},dataType:"script",cache:h})},getscript:function(l,m){var m=f.extend({},m);m._d=m._d||document;var j=m._d.getElementsByTagName("head")[0],k=m._d.createElement("script"),h=m.arg||[];k.type="text/javascript";if(m._b){k.innerHTML=m._b}if(l&&l!=""){k.src=l}if(f.browser.msie){k.onreadystatechange=function(){var n=k.readyState;if(n=="loaded"||n=="interactive"||n=="complete"){this.parentNode.removeChild(this);if(m.callback){return m.callback.apply(this,(h||[]))}}else{k.src=l}}}else{k.onload=function(){this.parentNode.removeChild(this);if(m.callback){return m.callback.apply(this,(h||[]))}}}j.appendChild(k)},cookie:function(l,m,j){if(arguments.length==0){try{if(navigator.cookieEnabled==false){return false}}catch(o){if(window.console){console.info(o)}}return true}if(arguments.length>1&&String(m)!=="[object Object]"){j=f.extend({},j);if(m===null||m===undefined){j.expires=-1}if(typeof j.expires==="number"){var p=j.expires,k=j.expires=new Date();k.setDate(k.getDate()+p)}m=String(m);return(document.cookie=[encodeURIComponent(l),"=",j.raw?m:encodeURIComponent(m),j.expires?"; expires="+j.expires.toUTCString():"",j.path?"; path="+j.path:"",j.domain?"; domain="+j.domain:"",j.secure?"; secure":""].join(""))}j=m||{};var h,n=j.raw?function(q){return q}:decodeURIComponent;return(h=new RegExp("(?:^|; )"+encodeURIComponent(l)+"=([^;]*)").exec(document.cookie))?n(h[1]):""},getParm:function(k,q){var p,n=window.location.toString(),j=k?k:n;if(f.type(j)=="object"){p=f.param(j);n=q?q:n;if(n.indexOf("?")==-1){n+="?"}else{n+="&"}return n+=p}else{if(f.type(j)=="string"){var h=j.split("?"),l=h[1],p={};if(l&&l.indexOf("&")){var m=l.split("&");jQuery.each(m,function(o,s){if(s&&s.indexOf("=")){var r=s.split("=");if(f.type(q)=="string"&&q==r[0]){p=r[1]==null?"":r[1];return true}else{p[r[0]]=r[1]}}})}}}return p},getUrl:function(j){var j=j||window.location.toString(),k=/(\w+):\/\/([^\:|\/]+)(\:\d*)?(.*\/)([^#|\?|\n]+)?(#.*)?(\?.*)?/i;var h=j.match(k);if(!!!h){var k=j.match(/(\w+):\/\/(.*)/);h=[k?k[0]:j,k?k[1]:"",k?k[2]:"","","","","",""]}return h},getBrowserType:function(){var h={msie:{v6:1,v7:5,v8:6,v9:8},firefox:2,opera:3,chrome:7,safari:4};return f.browser.name=="msie"?h.msie["v"+parseInt(f.browser.ver)]:h[f.browser.name]},getStrLen:function(p,l,n){if(!p){return}var r=/[^\x00-\xff]/ig,q=p.match(r);if(arguments.length==1){return p.length+(q==null?0:q.length)}var j=0,o="",m="",h=p.replace(r,"**").length;for(var k=0;k<h;k++){m=p.charAt(k).toString();if(m.match(r)!=null){j+=2}else{j++}if(j>l){break}o+=m}if(h>l&&f.type(n)=="string"){o+=n}else{if(h>l&&f.type(n)=="boolean"){o+="..."}}return o},getStringLen:function(h){return f.getStrLen(h)},ParseTpl:function(m,l){var h;var k=new RegExp("{{#([a-zA-z0-9]+)}}");while((h=k.exec(m))!=null){var j=l[h[1]]===0?"0":l[h[1]]||"";m=m.replace(new RegExp(h[0],"g"),j)}return m}})})(jQuery);Function.prototype.bindFunc=function(b){if(typeof(b)!="object"){return false}var a=this;return function(){return a.apply(b,arguments)}};var login_status="";var ssoUrl="";var logout_status="";var renew_status="";var PassportCardList=[];var PassportSC={version:2,ppsid:"$Id: pp18610_v2.min.js 121 2013-09-16 10:48:22Z wangqian $",appid:9999,max_line_length:30,domain:"",lastLogin:false,myDomainView:false,cookie:false,username:"",bindDomainSelector:true,autopad:"",autoRedirectUrl:"",loginRedirectUrl:"",logoutRedirectUrl:"",selectorTitle:"请选择您的用户帐号类型",registerUrl:"http://passport.tuan800.com/users/signup",recoverUrl:"http://passport.tuan800.com/users/password/index",postru:"",emailPostfix:false,curDSindex:-1,usePost:0,successCalledFunc:false,curCardIndex:0,rootElement:false,dsElement:false,sElement:false,cElement:false,dsAnchor:false,usernameInput:false,passwdInput:false,pcInput:false,loginMsg:false,iElement:false,isSetFocus:true,md5pwd:false,loginProtocal:"http",loginURL:"PASSPORT.TUAN800.COM/sso/login",logoutURL:"PASSPORT.TUAN800.COM/sso/logout",vurl:"http://PASSPORT.TUAN800.COM/sso/scripts?type=",http_url:false,login_urltpl:"{{#http}}://{{#url}}?username={{#username}}&password={{#pwd_md5}}&appid={{#appid}}&rememberme={{#pc}}&s={{#s}}&b={{#b}}&w={{#w}}&pwdtype=1&v={{#version}}",logins_urltpl:"{{#http}}://{{#url}}?username={{#username}}&password={{#pwd_md5}}&appid={{#appid}}&rememberme={{#pc}}&s={{#s}}&b={{#b}}&w={{#w}}&pwdtype=2&v={{#version}}",logoutp_urltpl:"{{#http}}://{{#url}}?s={{#s}}&ru={{#ru}}",logout_urltpl:"{{#http}}://{{#url}}?appid={{#appid}}",eInterval:false,maxIntervalCount:70,intervalCount:0,defualtRemPwd:"",isShowRemPwdMsg:0,campImg:"",campImgAlt:"",campUrl:"http://passport.tuan800.com/profile/index",cardTitle:"",firstDomain:"keyinfo",confirmInfo:"浏览器将保持通行证的登录状态，网吧或公共机房上网者请慎用。您能确认本次操作吗？",waitInfo:"正在登录通行证，请稍候...",returnTo:"",defaultApp:"",domainPool:["tuan800.com","zhe800.com","hui800.com"],domainList:["keyinfo","163.com","qq.com","hotmail.com","gmail.com","139.cn","189.cn"],appList:{"1000":"tuan800","2000":"zhe800","3000":"hui800"},appName:{tuan800:"团800",zhe800:"折800",hui800:"惠800"},appUrl:{tuan800:"http://www.tuan800.com",zhe800:"http://www.zhe800.com",hui800:"http://www.hui800.com"},appPool:false,bottomRow:[],recomServ:[],reverseFirstDomain:false,showEmailInputTip:true,usePostFix:true,gotohref:function(a){window.href=a;$("body").append($("<a>").attr("href",a).bind("click",function(){window.location=$(this).attr("href");return}).trigger("click"))},getDomain:function(){var b=document.domain.split(".");var a=b.length;if(a<=2){return document.domain}return b[a-2]+"."+b[a-1]},getPassportDomain:function(){return""},preventEvent:function(a){a.cancelBubble=true;a.returnValue=false;if(a.preventDefault){a.preventDefault()}if(a.stopPropagation){a.stopPropagation()}},getTime:function(){var a=new Date();return a.getTime()},reportMsg:function(a){var b="";switch(a){case"1":b+="请输入通行证用户名";break;case"2":b+="通行证用户名为邮件地址格式";break;case"3":b+="用户名后缀必须为"+arguments[1];break;case"4":b+="请输入通行证密码";break;case"5":break;case"6":b+="登录超时，请稍后重试";break;case"7":b+="登录失败，请重试";break;case"8":b+="网络故障，退出失败，请重新退出";break;case"9":b+="用户名或密码错误，请重试";break;case"10":b+="暂时不可登录，请稍后重试";break;case"11":b+="浏览器设置有误，请查看帮助修正";break;case"12":b+='账号尚未激活，重发<a href="http://passport.tuan800.com/users/confirmation/new?email='+this.usernameInput.val()+'" target="_blank">激活邮件</a>';break;case"13":b+="外域名注册！！";break;default:b+="登录错误，请稍后重试"}this.showMsg(b)},showMsg:function(a){if(!this.loginMsg){return}this.loginMsg.html(a).show()},cookieHandle:function(){if(!this.cookie){this.parsePassportCookie()}if(this.cookie&&this.cookie.userid!=""){return this.cookie.userid}else{return""}},getDisplayName:function(){var b=this.cookieHandle();var a=b.split("@");var d=a[0];var c=/^1\d{10}$/;if(c.test(d)){return d.substring(0,3)+"****"+d.substring(7)}else{return b}},parsePassportCookie:function(){var c="";if($.cookie("ppinf")!=""){c=unescape($.cookie("ppinf"))}if(c===""){this.cookie=false;return}try{var a=c.split("|");var b=Base64.decode(a[3]);this._parsePassportCookie(b)}catch(d){if(window.console){console.info(d)}}},_parsePassportCookie:function(f){var b=this,c=$.parseJSON(f);this.cookie=new Object;$.each(c,function(g,e){b.cookie[g]=e});try{this.cookie.service=new Object;var a=this.cookie.service;a.tuan800=1;a.tao800=1;a.zhe800=1;a.hui800=1}catch(d){if(window.console){console.info(d)}}},parseAppid:function(){var d=this.appid.toString();var c=0;this.appPool=new Array();for(var b in this.appList){var a=this.appList[b];if(typeof(a)!="string"){continue}if(b==d){this.defaultApp=this.appName[a]}else{this.appPool[c]={app:a,name:this.appName[a],url:this.appUrl[a]};c++}}},getBottomRow:function(){var a=0;var b=this.max_line_length-$.getStringLen(this.defaultApp);this.bottomRow[0]=new Array();this.bottomRow[1]=new Array();if(!this.cookie){return}a=this._getBottomRow(this.bottomRow[0],b,0);b=this.max_line_length;a=this._getBottomRow(this.bottomRow[1],b,a)},_getBottomRow:function(l,f,c){var a,d;var h=this.cookie.service;var g=this.appPool;var e=c;var k;for(d=0;e<g.length;e++){a=g[e]["app"];if(e==0||e==1){k=$.getStringLen(g[e]["name"]);if(f-k<0){break}f-=(k+2);l[d]=g[e];d++;continue}if(typeof(h[a])=="undefined"){continue}if(h[a]!=0){k=$.getStringLen(g[e]["name"]);if(f-k<0){break}f-=(k+2);l[d]=g[e];d++}else{var b=this.recomServ.length;this.recomServ[b]=g[e]}}return e},parseLastDomain:function(f){this.emailPostfix=new Array();var h="",b="";var e="",g="",a=[];var c=0;if(this.firstDomain!=""){for(var d in f){if(this.firstDomain==f[d]){b=f[d];break}}if(b!=""){this.emailPostfix[c]=b;c++}}for(var d in f){if(typeof(f[d])!="string"){continue}if(f[d]!=this.domain&&f[d]!=h&&f[d]!=b){this.emailPostfix[c]=f[d];c++}}},doPost:function(){for(var e=0;e<document.forms.length;e++){if(document.forms[e].name=="loginform"){break}}if(e==document.forms.length){document.location.href="http://passport.tuan800.com";return false}var d={url:"passport.tuan800.com/login",appid:this.appid,ru:this.postru,b:a,w:c,version:this.version};var a=getBrowserType();var c=screen.width;document.forms[e].action=$.ParseTpl("{{#url}}?appid={{#appid}}&ru={{#ru}}&b={{#b}}&w={{#w}}&v={{#version}}",d);document.forms[e].submit();return false},doLogin:function(){if(this.eInterval){return}if(arguments[0]){PassportCardList[index].doLogin()}login_status="";this.intervalCount=0;this.sElement.empty();this.username=$.trim(this.usernameInput.val());var d=this.username;var b=$.trim(this.passwdInput.val());var a=0;if(this.pcInput&&this.pcInput.prop("checked")==true){a=1}if(d==""){this.reportMsg("1");this.usernameInput.focus();return false}if(this.autopad!=""){var c=email.substr(email.lastIndexOf("@")+1);if(this.autopad.lastIndexOf(c)<0){this.reportMsg("3",this.autopad);this.usernameInput.focus();this.passwdInput.value="";return false}}if(b==""){this.reportMsg("4");this.passwdInput.value="";this.passwdInput.focus();return false}if(this.usePost==1){return this.doPost()}this.drawPassportWait(this.waitInfo);return this.loginHandle(d,b,a,this.sElement,this.loginFailCall.bindFunc(this),this.loginSuccessCall.bindFunc(this))},loginHandle:function(g,k,m,r,l,c){if(typeof(r)!="object"){return false}if($.cookie()==false){l();return false}login_status="";var n=$.getBrowserType();var o=screen.width;if(this.domain==""){this.domain=this.getDomain()}var q=this.getTime();var f=this.md5pwd?function(){return $.md5?$.md5(k):k}:k;var j={http:this.loginProtocal,url:this.loginURL,username:encodeURIComponent(g),pwd_md5:encodeURIComponent(f),appid:this.appid,pc:m,s:q,b:n,w:o,version:this.version};var d=this.login_urltpl;try{if(this.loginProtocal=="https"){d=this.logins_urltpl}this.http_url=$.ParseTpl(d,j);var a=this.http_url}catch(h){if(this.loginProtocal=="https"){d=this.https_urltpl}this.http_url=$.ParseTpl(d,j);var a=this.http_url;if(window.console){console.info(h)}}a+="&domain="+this.domain;if(this.returnTo!=""){a+="&return_to="+this.returnTo}$.getScript(a,true);var p=this;this.eInterval=setInterval(function(){p.loginIntervalProc(l,c,r)},100);return false},loginIntervalProc:function(b,c,d){if(login_status==""&&this.intervalCount<this.maxIntervalCount){this.intervalCount++;return}clearInterval(this.eInterval);this.eInterval=false;if(login_status!="success"||this.intervalCount>=this.maxIntervalCount){if(this.loginProtocal=="https"&&login_status==""){this.intervalCount=0;this.loginProtocal="http";this.http_url+="&domain="+this.domain;$.getScript(this.http_url,true);var a=this;this.eInterval=setInterval(function(){a.loginIntervalProc(b,c,d)},100)}else{b()}return}if(this.loginRedirectUrl==""){this.autoProcAllDomain("login",d)}else{$.cookie("crossdomain",this.getTime(),{path:"/",expires:336})}c()},loginFailCall:function(){this.sElement.html("");this.drawLoginForm();var a=login_status;if(this.intervalCount>=this.maxIntervalCount){this.reportMsg("6");this.usernameInput.focus()}else{if($.cookie()==false){this.reportMsg("11");this.usernameInput.focus()}else{switch(a){case"error1":this.reportMsg("9");this.passwdInput.focus();break;case"error2":this.reportMsg("5");this.passwdInput.focus();break;case"error3":this.reportMsg("5");this.passwdInput.focus();break;default:this.reportMsg(a);this.passwdInput.focus();break}}}},loginSuccessCall:function(){this.parsePassportCookie();if(this.cookie&&this.cookie.username!=""){this.username="";if(this.loginRedirectUrl!=""){if(document.location.href==this.loginRedirectUrl){document.location.reload()}else{PassportSC.gotohref(this.loginRedirectUrl)}}else{this.getBottomRow();this.drawPassportCard();for(i=0;i<PassportCardList.length;i++){if(i==this.curCardIndex){continue}PassportCardList[i].parsePassportCookie();PassportCardList[i].getBottomRow();PassportCardList[i].drawPassportCard()}}try{this.loginApp()}catch(a){if(window.console){console.info(a)}}}else{this.drawLoginForm();this.reportMsg("7")}},doLogout:function(){if(this.eInterval){return}this.intervalCount=0;this.sElement.html("");if(this.usePost==1){window.location=$.ParseTpl(this.logoutp_urltpl,{http:this.loginProtocal,url:this.logoutURL,s:this.getTime(),ru:this.postru})}else{this.logoutHandle(this.sElement,this.logoutFailCall.bindFunc(this),this.logoutSuccessCall.bindFunc(this,"dd"))}},logoutHandle:function(e,b,d){if(typeof(e)!="object"){return false}logout_status="";if(this.domain==""){this.domain=this.getDomain()}var f=this.getTime();var c=$.ParseTpl(this.logout_urltpl,{http:this.loginProtocal,url:this.logoutURL,appid:this.appid});c+="&domain="+this.domain;$.getScript(c);var a=this;this.eInterval=setInterval(function(){a.logoutIntervalProc(b,d,e)},100)},logoutIntervalProc:function(a,b,c){if(logout_status==""&&this.intervalCount<this.maxIntervalCount){this.intervalCount++;return}clearInterval(this.eInterval);this.eInterval=false;if(logout_status!="success"||this.intervalCount>=this.maxIntervalCount){a();return}if(this.logoutRedirectUrl==""){this.autoProcAllDomain("logout",c)}else{$.cookie("crossdomain_logout",this.getTime(),{path:"/",expires:336})}b()},logoutFailCall:function(){this.sElement.html("");this.reportMsg("8")},logoutSuccessCall:function(b){this.parseLastDomain(this.domainList);this.cookie=false;this.drawLoginForm();if(this.logoutRedirectUrl!=""){if(document.location.href==this.logoutRedirectUrl){document.location.reload()}else{PassportSC.gotohref(this.logoutRedirectUrl)}}else{for(i=0;i<PassportCardList.length;i++){if(i==this.curCardIndex){continue}PassportCardList[i].drawLoginForm()}}try{this.logoutApp()}catch(a){if(window.console){console.info(a)}}},refreshCookie:function(e,a,d){var b="http://passport.tuan800.com/sso/refresh?_t="+new Date().getTime();if(b){var c=$("<iframe></iframe>");c.css({height:0,width:0}).attr("src",b);$("body").append(c)}return false},renewCookie:function(f,b,e){if(typeof(f)!="object"){return false}if(this.domain==""){this.domain=this.getDomain()}var g=this.getTime();var c="http://passport.tuan800.com/sso/refresh?ra"+g;c+="&domain="+this.domain;if(c){var d=$("<iframe></iframe>");d.css({height:0,width:0}).attr("src",vurl);f.append(d)}$.getScript(c);var a=this;this.eInterval=setInterval(function(){a.renewIntervalProc(b,e,f)},100);return false},renewIntervalProc:function(a,b,c){if(renew_status==""&&this.intervalCount<this.maxIntervalCount){this.intervalCount++;return}clearInterval(this.eInterval);this.eInterval=false;if(renew_status!="success"||this.intervalCount>=this.maxIntervalCount){try{a()}catch(d){if(window.console){console.info(d)}}return}this.autoProcAllDomain("renew",c);try{b()}catch(d){if(window.console){console.info(d)}}},autoProcAllDomain:function(d,c){var a=this.crossDomainIframeUrl(d);if(a){var b=$("<iframe></iframe>");b.css({height:0,width:0}).attr("src",a);c.append(b)}},doCrossDomainCookie:function(o,g){if(typeof(o)!="object"){return}var k="crossdomain";if(g=="logout"){k="crossdomain_logout"}if(this.domain==""){this.domain=this.getDomain()}var a=$.cookie(k),b=$.cookie("ppinf"),e=$.cookie("ppinf_lastTime"),l="ppinf_lastTime";var h=function(){var p=$("<iframe></iframe>");p.css({height:0,width:0}).attr("src","http://passport.tuan800.com/sso/refresh?_t"+new Date().getTime());o.append(p)};if(a==""||a=="0"){if(b==""&&g=="logout"&&e!=""){$.cookie(l,"",{path:"/",domain:"."+this.domain,expires:(new Date(0))})}else{if(b!=""&&g=="login"){var f,d,m=parseInt($.cookie("ppinf").split("|")[1]);f=new Date(m);if(e==""){f.setDate(f.getDate()+1);$.cookie(l,m,{path:"/",domain:"."+this.domain,expires:f});h()}else{var d=new Date(parseInt(e));f.setHours(0,0,0);d.setHours(0,0,0);var n=Math.floor((Date.parse(f)-Date.parse(d))/24/1000/3600);if(n>0){h();$.cookie(l,new Date().getTime(),{path:"/",domain:"."+this.domain,expires:m})}}}}return}var c=this.crossDomainIframeUrl(g);if(c){var j=$("<iframe></iframe>");j.css({height:0,width:0}).attr("src",c);o.append(j);$.cookie(k,"",{path:"/",domain:"."+this.domain,expires:(new Date(0))});$.cookie(k,"",{path:"/",expires:(new Date(0))})}},crossDomainUrl:function(c,b){var d=this.getTime();var a="http://passport.tuan800.com/sso/scripts?s="+d+"&type="+c+"&current_site="+b;return a},crossDomainIframeUrl:function(b){var a=this.vurl+b+"&domain="+this.domain;return a},setDomainCookie:function(f,e,d,b){login_status="";crossdomain_status="";var c=this.crossDomainUrl("login",e);if(c){$.getScript(c)}var a=this;this.eInterval=setInterval(function(){a.setCookieIntervalProc(f,d,b)},100)},setCookieIntervalProc:function(c,b,a){if(crossdomain_status!=""){clearInterval(this.eInterval);this.eInterval=false;a();return}if(login_status==""&&this.intervalCount<this.maxIntervalCount){this.intervalCount++;return}clearInterval(this.eInterval);this.eInterval=false;if(login_status!="success"||this.intervalCount>=this.maxIntervalCount){a();return}b()},downDSindex:function(){var a=this.dsAnchor.find("tr");if(a.size()==0){return}var b=0,c=this.curDSindex;a.each(function(d){if($(this).find("td:first").prop("idx")==c){b=d;return false}});if(b>=a.size()-1){this.curDSindex=a.eq(0).find("td:first").prop("idx")}else{this.curDSindex=a.eq(b+1).find("td:first").prop("idx")}},upDSindex:function(){var a=this.dsAnchor.find("tr");if(a.size()==0){return}var d=-1,b=0,c=this.curDSindex;a.each(function(e){if($(this).find("td:first").prop("idx")==c){b=e;return false}d=a.eq(e).find("td:first").prop("idx")});if(b==a.size()){this.curDSindex=a.eq(0).find("td:first").prop("idx")}else{if(d==-1){this.curDSindex=a.eq(a.size()-1).find("td:first").prop("idx")}else{this.curDSindex=d}}},findDSindex:function(b){try{var a=this.dsAnchor.find("tr"),d="";a.each(function(){if($(this).find("td:first").prop("idx")==b){d=$(this).find("td:first");return false}});return d}catch(c){if(window.console){console.info(c)}}return false},clearFocus:function(b){if(typeof(b)!="number"){b=this.curDSindex}try{var a=this.findDSindex(b);a.removeClass().css("font-weight","normal")}catch(c){if(window.console){console.info(c)}}},setFocus:function(b){if(typeof(b)!="number"){b=this.curDSindex}try{var a=this.findDSindex(b);a.removeClass().addClass("active")}catch(c){if(window.console){console.info(c)}}},fillEmailSelect:function(){var t=this.usernameInput.val();if(!this.dsElement){return false}if(t==""){this.dsElement.hide();this.dsAnchor.empty();return}var n=this;var f="";var p='<tr><td id="email_postfix_{{#id}}">{{#usePostFix}}</td></tr>';var u="";var a="";var o=t.lastIndexOf("@");if(o<0){a=t}else{if(o==t.length-1){a=t.substr(0,o)}else{a=t.substr(0,o);u=t.substr(o+1)}}var k=parseInt(this.usernameInput.offset().left-this.cElement.offset().left);if($.browser.msie){}this.dsElement.css("margin-left",k+"px");this.dsElement.css("margin-top",this.usernameInput.offset().top-this.cElement.offset().top+this.usernameInput.get(0).offsetHeight-1+"px");this.dsElement.css({"z-index":999999,padding:0,"background-color":"white"});this.dsAnchor.empty().append('<table width="100%" cellspaceing="0" cellpadding="3"><tbody></tbody></table>');var b=this.dsAnchor.find("tbody:first");var q=0;var c=false;var l=false;var v=-1;var m="",d="";var h=this.emailPostfix;var s=/^1.*$/;if(s.test(t)){if(this.autopad!=""){h=["mobile",this.autopad]}else{h=["mobile"]}}for(var r=0;r<h.length;r++){var g=h[r];if(typeof(g)!="string"){continue}if(u!=""){if(g.lastIndexOf(u)!=0){continue}}q++;if(v==-1){v=r}if(this.curDSindex==r){c=true}if(g=="keyinfo"||g=="mobile"){f=t}else{if(l==false){if(this.usePostFix){f=a+"@"+g}else{f=a}}else{if(this.usePostFix){f=g}else{usePostFixL=g.substring(0,g.lastIndexOf("@"))}}}code=$($.ParseTpl(p,{id:r,usePostFix:f}));code.find("td:first").prop("idx",r).bind("mouseover",function(){n.clearFocus();n.curDSindex=this.idx;n.setFocus();this.style.cursor="pointer"}).bind("click",n.doSelect);b.append(code);l=false}if(q>0){this.dsElement.show();if(c==false){this.curDSindex=v}this.setFocus()}else{this.dsElement.hide();this.curDSindex=-1}},doSelect:function(){if(!this.dsElement){return false}this.dsElement.hide();var a=this.findDSindex(this.curDSindex);if(a){var b=a.html();if(b){this.usernameInput.val(b.replace(/&amp;/g,"&"))}}if(this.usernameInput.val()!=""){this.passwdInput.focus()}},checkKeyDown:function(a){a=a||window.event;var b=a.keyCode||a.which||a.charCode;if(b==38||b==40){if(a.shiftKey==1){return}this.clearFocus();if(b==38){this.upDSindex()}else{if(b==40){this.downDSindex()}}this.setFocus()}},checkKeyPress:function(b){b=b||window.event;var c=b.keyCode||b.which||b.charCode;if(c==13){this.preventEvent(b)}else{if(c==38||c==40){if(b.shiftKey==1){return}this.preventEvent(b);this.clearFocus();if(c==38){this.upDSindex()}else{if(c==40){this.downDSindex()}}this.setFocus()}else{if(c==108||c==110||c==111||c==115){var a=this;setTimeout(function(){a.fillEmailSelect()},10)}}}},checkKeyUp:function(a){a=a||window.event;var b=a.keyCode||a.which||a.charCode;this.fillEmailSelect();if(b==13){this.doSelect()}if($.getBrowserType()==7||$.getBrowserType()==4){if(b==38||b==40){if(a.shiftKey==1){return}this.clearFocus();if(b==38){this.upDSindex()}else{if(b==40){this.downDSindex()}}this.setFocus()}}},checkMousedown:function(){if(this.usernameInput.val()=="通行证帐号/手机号"){this.usernameInput.val("");this.usernameInput.focus();return}},rootElement:function(b){this.rootElement=b;this.rootElement.html('<div class="ppselecter" style="position: absolute; display: none;"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td style="" class="ppseltit">'+this.selectorTitle+'</td></tr><tr><td /></tr></tbody></table></div><div style="display: none;"></div><div class="passportc"></div>');if(this.selectorTitle==null||this.selectorTitle.length==0){this.rootElement.html('<div class="ppselecter" style="position: absolute; display: none;"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr></tr><tr><td height="0" /></tr><tr><td /></tr></tbody></table></div><div style="display: none;"></div><div class="passportc"></div>')}var a=this.rootElement.find("div");this.dsElement=a.eq(0);this.dsAnchor=this.dsElement.find("td:last");this.sElement=a.eq(1);this.cElement=a.eq(2)},init:function(a){this.rootElement(a);this.domain=this.getDomain();this.parseLastDomain(this.domainList);this.parseAppid();this.parsePassportCookie();this.getBottomRow();if(this.postru==""){this.postru=document.location.href}},_drawPassportCard:function(){},drawPassportCard:function(){this._drawPassportCard();this.$iElement();try{this.successCalledFunc(this.iElement)}catch(a){this.drawPassportInfo();if(window.console){console.info(a)}}},$iElement:function(){this.iElement=this.cElement.find(".listContA")},drawPassportWait:function(a){},drawPassportInfo:function(){},getRanServ:function(){var d=this.recomServ.length;if(d==0){return""}var b=Math.floor(d*(Math.random()));var c='<a href="'+this.recomServ[b]["url"]+'" target="_blank">'+this.recomServ[b]["name"]+"</a>";if(d==1){return c}var a=Math.floor(d*(Math.random()));while(b==a){a=Math.floor(d*(Math.random()))}c+=' | <a href="'+this.recomServ[a]["url"]+'" target="_blank">'+this.recomServ[a]["name"]+"</a>";return c},_drawLoginForm:function(){},drawLoginForm:function(){this._drawLoginForm();var a=this.cElement.find("input");var b=this;a.each(function(){if($(this).attr("name")=="username"){b.usernameInput=$(this)}if($(this).attr("name")=="password"){b.passwdInput=$(this)}if($(this).attr("name")=="remember_me"){b.pcInput=$(this)}});this.loginMsg=this.cElement.find(".error");if(this.isShowRemPwdMsg==0&&this.pcInput){this.pcInput.bind("click",function(){if(b.pcInput.prop("checked")==false){return}var c=window.confirm(b.confirmInfo);if(c==false){b.pcInput.attr("checked",false)}})}this.bindSelector();this.autoFillUserId();var b=this;if(this.usernameInput.val()==""){if(this.isSetFocus){setTimeout(function(){b.usernameInput.focus()},50)}}else{if(this.isSetFocus&&this.usernameInput.val()!="通行证帐号/手机号"){setTimeout(function(){b.passwdInput.focus()},50)}}},autoFillUserId:function(){if(this.showEmailInputTip){this.showEmailInputTip=false;return}var a=$.cookie("pptmpuserid");if(this.username.length>0){this.usernameInput.val(this.username)}else{this.usernameInput.val(a)}if(a.length>0){var b=this;setTimeout(function(){$.cookie("pptmpuserid",this.getTime(),{path:"/",expires:(new Date(0))})},1000)}},bindSelector:function(){if(this.bindDomainSelector){this.curDSindex=-1;this.usernameInput.bind("mousedown",this.checkMousedown.bindFunc(this)).bind("keypress",this.checkKeyPress.bindFunc(this)).bind("keyup",this.checkKeyUp.bindFunc(this)).bind("blur",this.doSelect.bindFunc(this));if($.browser.msie){this.usernameInput.bind("keydown",this.checkKeyDown.bindFunc(this))}}},drawPassport:function(element){var self=this;if($.type(element)=="string"){element=$("#"+element);if(element.size()==0){return false}}else{if($.type(element)=="object"){element=$(element)}else{return}}if(this.md5pwd){$.getScript("http://passport.tuan800.com/js/jquery.md5.min.js",true)}if(PassportCardList.length==0){PassportCardList[0]=this}if(!this.successCalledFunc){try{this.successCalledFunc=eval("drawAppInfo")}catch(e){this.successCalledFunc=this.drawPassportInfo}}this.init(element);if(this.cookie&&(this.cookie.username!="")){if(this.autopad!=""){var userid=this.cookie.userid;var at=userid.lastIndexOf("@");if(at>0){if(this.autopad.lastIndexOf(userid.substr(at+1))<0){this.drawLoginForm();return}}}if(this.autoRedirectUrl!=""){PassportSC.gotohref(this.autoRedirectUrl)}else{this.drawPassportCard()}}else{this.drawLoginForm()}},drawPassportNew:function(c,j,h){if($.type(c)==="string"){c=$("#"+c);if(c.size()==0){return false}}else{if($.type(c)==="object"){c=$(c)}else{return}}var f=new Function();f.prototype=this;var b=PassportCardList.length;var d=new f();var a=($.type(h)==="array"?h[0]:[]);d.successCalledFunc=(a==="function")?a:false;d.appid=($.type(j)==="number")?j:9999;d.curCardIndex=b;d.isSetFocus=false;PassportCardList[b]=d;var k=[b,c];k.push(h);if($.type(j)==="function"){j.apply(this,(k||[]))}else{try{window.drawPassportNewInit(b,c)}catch(g){if(window.console){console.info(g)}}}return}};$.passport=$.extend({},PassportSC);if(typeof(PP_SETCROSSDOMAIN)=="undefined"){var ele=$("head");PassportSC.doCrossDomainCookie(ele,"login");PassportSC.doCrossDomainCookie(ele,"logout")}if(typeof encodeURIComponent=="undefined"){PassportSC.usePost=1}if($.getBrowserType()==3&&(screen.height==5000||window.navigator.userAgent.lastIndexOf("Mini")>=0)){PassportSC.usePost=1};